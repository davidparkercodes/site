---
import Site from '@layouts/Site.astro'
import BackButton from '@components/BackButton.astro'
import { CollectionEntry, getCollection } from 'astro:content'
import { JsonLd } from '@utils/seo'
import { site } from '@utils/site'

const base = import.meta.env.BASE_URL
const join = (b: string, p: string) => `${b.replace(/\/$/, '')}/${p.replace(/^\//, '')}`

export async function getStaticPaths() {
  const posts = await getCollection('articles')
  return posts.filter(p => !p.data.draft).map(p => ({ params: { slug: p.slug }, props: { post: p } }))
}
const { post } = Astro.props as { post: CollectionEntry<'articles'> }
const { Content } = await post.render()
---
<Site>
  <script type="application/ld+json" set:html={JSON.stringify({
    '@context': 'https://schema.org',
    '@type': 'Article',
    headline: post.data.title,
    description: post.data.description,
    datePublished: post.data.pubDate.toISOString(),
    dateModified: (post.data.updatedDate || post.data.pubDate).toISOString(),
    author: { '@type': 'Person', name: site.author.name },
    mainEntityOfPage: `${site.url}/articles/${post.slug}`
  })}></script>
  <section class="px-6 md:px-8 py-12">
    <article class="mx-auto max-w-3xl">
      <div class="mb-8">
        <BackButton defaultText="Back to Articles" defaultHref={join(base, 'articles')} />
      </div>
      <div class="prose dark:prose-invert">
        <h1 class="font-mono flex items-center gap-3">
          <svg class="w-10 h-10 md:w-12 md:h-12 flex-shrink-0" fill="none" stroke="#ffff00" strokeWidth="2" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h12a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
          {post.data.title}
        </h1>
        <p class="text-zinc-600 dark:text-zinc-400">{post.data.description}</p>
        <Content />
      </div>
    </article>
  </section>
  <script>
    import('/src/utils/code-copy.ts').then(m=> m.default())
  </script>
</Site>

