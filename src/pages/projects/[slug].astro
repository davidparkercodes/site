---
import Site from '@layouts/Site.astro'
import BackButton from '@components/BackButton.astro'
import { getCollection } from 'astro:content'
import type { CollectionEntry } from 'astro:content'

export async function getStaticPaths() {
  const projects = await getCollection('projects')
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project }
  }))
}

type Props = {
  project: CollectionEntry<'projects'>
}

const { project } = Astro.props
const { Content } = await project.render()

const base = import.meta.env.BASE_URL
const join = (b: string, p: string) => `${b.replace(/\/$/, '')}/${p.replace(/^\//, '')}`
---
<Site>
  <article class="px-6 md:px-8 py-16">
    <div class="mx-auto max-w-4xl">
      <div class="mb-8">
        <BackButton defaultText="Back to Projects" defaultHref={join(base, 'projects')} />
      </div>
      <h1 class="text-4xl md:text-5xl font-mono tracking-tight flex items-center gap-3">
        <svg class="w-10 h-10 md:w-12 md:h-12 flex-shrink-0" fill="none" stroke="#00ffff" strokeWidth="2" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
        </svg>
        {project.data.title}
      </h1>
      <p class="mt-4 text-lg text-zinc-600 dark:text-zinc-400">
        {project.data.description}
      </p>
      <div class="mt-6 flex flex-wrap gap-1.5">
        {project.data.technologies.map((tech) => (
          <span class="text-xs font-mono px-2 py-0.5 rounded-full border border-zinc-700 text-zinc-500 dark:text-zinc-400">
            {tech}
          </span>
        ))}
      </div>
      {(project.data.link || project.data.github) && (
        <div class="mt-6 flex gap-4">
          {project.data.link && (
            <a 
              href={project.data.link} 
              target="_blank" 
              rel="noopener noreferrer"
              class="inline-flex items-center gap-1 font-mono text-sm interactive hover:underline"
            >
              View Project
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
              </svg>
            </a>
          )}
          {project.data.github && (
            <a 
              href={project.data.github} 
              target="_blank" 
              rel="noopener noreferrer"
              class="inline-flex items-center gap-1 font-mono text-sm interactive hover:underline"
            >
              GitHub
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
              </svg>
            </a>
          )}
        </div>
      )}
      <div class="mt-12 prose prose-zinc dark:prose-invert max-w-none">
        <Content />
      </div>
    </div>
  </article>
</Site>
